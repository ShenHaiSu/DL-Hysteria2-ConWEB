const __vite__fileDeps=["assets/IconUser-B_MU_YOl.js","assets/index-Ctqlg4E2.js","assets/index-DBz_WDjk.css","assets/index-BLLWnMNT.js","assets/index-CfqfyTJ_.js","assets/index-5C7ZWeu7.js","assets/index-BFm6H7b7.js","assets/index-0hJYCdWf.js","assets/index-exrYB_uQ.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{h as W,H as v,G as $,j as G,o as H,J as _,a as m,k as h,b as t,d as o,e as r,t as U,w as i,F as D,A as J,f as k,c as M,x as Q,g as P,_ as w,K as q,N as X,P as Y,Q as Z}from"./index-Ctqlg4E2.js";import ee from"./index-CnUtn8Pn.js";import{m as E}from"./md5-B0f4dnXe.js";import{u as se}from"./auth-hzN6lpHJ.js";const u=p=>(Y("data-v-5a759052"),p=p(),Z(),p),te=u(()=>t("div",null,[t("h2",null,"认证界面")],-1)),ae={key:0,AuthCardDialogAuthed:""},oe={style:{width:"100%"}},le=u(()=>t("td",null,"用户名",-1)),re=u(()=>t("td",null,"权限级别",-1)),ne={colspan:"2"},ie=u(()=>t("br",null,null,-1)),ue=u(()=>t("br",null,null,-1)),de={key:1,AuthCardDialogUnauthed:""},me=u(()=>t("label",null,"账户名",-1)),ce=u(()=>t("label",null,"密码",-1)),ve=u(()=>t("label",null,"管理员秘钥",-1)),_e=u(()=>t("br",null,null,-1)),he={__name:"AuthShow",setup(p){const x=P(()=>w(()=>import("./IconUser-B_MU_YOl.js"),__vite__mapDeps([0,1,2]))),N=P(()=>w(()=>import("./index-BLLWnMNT.js"),__vite__mapDeps([3,1,2]))),T=P(()=>w(()=>import("./index-CfqfyTJ_.js"),__vite__mapDeps([4,1,2,5,6,7]))),K=P(()=>w(()=>import("./index-exrYB_uQ.js"),__vite__mapDeps([8,1,2]))),e=se(),f=v(!1),d=v(""),y=v(!1),g=v(""),c=v(""),l=$(),C=()=>d.value.length==0||c.value.length==0,b=()=>E(E(c.value+"DAOLUOLTS").toString()),z=()=>{f.value=!0,y.value=!1,d.value="",c.value="",g.value=""},O=G(()=>Object.keys(e.getUserInfo()));H(()=>{_("/auth/checkLogin",{method:"post"}).then(a=>{const s=a.data;e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0),l.add({severity:"success",summary:"身份验证",detail:"已通过身份验证，欢迎回来："+s.userName,life:3e3})}).catch(()=>{l.add({severity:"error",summary:"当前未登录",detail:"请先登录",life:3e3})})});const B=()=>{if(C())return l.add({severity:"error",summary:"错误",detail:"账号或密码不能为空",life:3e3});if(!y.value)return y.value=!0;_("/auth/register",{method:"post",data:{userName:d.value,userPassword:b(),adminKey:g.value}}).then(a=>{const s=a.data;e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0)}).catch(a=>{l.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},A=()=>{if(C())return l.add({severity:"error",summary:"错误",detail:"账号或密码不能为空",life:3e3});_("/auth/login",{method:"post",data:{userName:d.value,userPassword:b()}}).then(a=>{const s=a.data;e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0),l.add({severity:"success",summary:"成功",detail:s.msg,life:3e3}),f.value=!1}).catch(a=>{l.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},F=()=>{if(!e.getIsLogin())return l.add({severity:"error",summary:"错误",detail:"当前已经是未登录状态，请刷新页面尝试修正显示。",life:3e3});_("/auth/logout",{method:"post"}).then(a=>{a.data,e.setIsLogin(!1),e.setUserName(""),e.setUserPermission("none"),e.coverUserInfo({}),l.add({severity:"success",summary:"成功",detail:"完成登出，现在是未登录状态。",life:3e3}),location.reload()}).catch(a=>{l.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},R=()=>{if(!e.getIsLogin())return l.add({severity:"error",summary:"错误",detail:"当前已经是未登录状态，请刷新页面尝试修正显示。",life:3e3});_("/auth/checkLogin",{method:"post"}).then(a=>{const s=a.data;e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0),l.add({severity:"success",summary:"成功",detail:"已收到服务器下发的新Session",life:3e3})}).catch(a=>{l.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},S=a=>{if(a.key=="Enter")return A()},j=()=>{switch(e.getUserPermission()){case"none":return"";case"user":return"success";case"admin":return"danger"}};return(a,s)=>{const L=ee,I=q,V=X;return m(),h(D,null,[t("div",{AuthCardContainer:"",onClick:z},[o(r(x)),t("span",null,U(r(e).getIsLogin()?r(e).getUserName():"未登录"),1)]),o(r(T),{visible:f.value,"onUpdate:visible":s[3]||(s[3]=n=>f.value=n),modal:"",header:"认证界面",style:{maxWidth:"50vw",minWidth:"350px"}},{header:i(()=>[te]),default:i(()=>[r(e).isLogin?(m(),h("div",ae,[t("div",null,[t("table",oe,[t("tbody",null,[t("tr",null,[le,t("td",null,U(r(e).getUserName()),1)]),t("tr",null,[re,t("td",null,[o(r(K),{value:r(e).getUserPermission(),severity:j(),rounded:""},null,8,["value","severity"])])]),t("tr",null,[t("td",ne,[o(L,{style:{width:"100%"}})])]),(m(!0),h(D,null,J(O.value,n=>(m(),h("tr",null,[t("td",null,U(n),1),t("td",null,U(r(e).getUserInfo()[n]),1)]))),256))])]),ie,ue]),t("div",null,[o(I,{size:"small",onClick:R},{default:i(()=>[k("刷新")]),_:1}),o(L,{layout:"vertical"}),o(I,{size:"small",onClick:F},{default:i(()=>[k("登出")]),_:1})])])):(m(),h("div",de,[t("div",null,[o(r(N),null,{default:i(()=>[o(V,{size:"small",onKeydown:S,modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=n=>d.value=n),placeholder:"必填"},null,8,["modelValue"]),me]),_:1}),o(r(N),null,{default:i(()=>[o(V,{size:"small",type:"password",onKeydown:S,modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=n=>c.value=n),placeholder:"必填"},null,8,["modelValue"]),ce]),_:1}),y.value?(m(),M(r(N),{key:0},{default:i(()=>[o(V,{size:"small",modelValue:g.value,"onUpdate:modelValue":s[2]||(s[2]=n=>g.value=n),placeholder:"选填"},null,8,["modelValue"]),ve]),_:1})):Q("",!0)]),_e,t("div",null,[o(I,{size:"small",onClick:B,severity:"secondary"},{default:i(()=>[k("注册")]),_:1}),o(L,{layout:"vertical"}),o(I,{size:"small",onClick:A},{default:i(()=>[k("登录")]),_:1})])]))]),_:1},8,["visible"])],64)}}},Ie=W(he,[["__scopeId","data-v-5a759052"]]);export{Ie as default};
