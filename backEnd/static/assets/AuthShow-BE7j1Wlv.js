const __vite__fileDeps=["assets/IconUser-BBjiCtaS.js","assets/index-zLBKAhNj.js","assets/index-BKgpESBG.css","assets/index-CtRsV90Y.js","assets/index-CgkV2Wch.js","assets/index-5nyeFgbn.js","assets/index-DWgOhlRZ.js","assets/index-4-MvVKeW.js","assets/index-DxQT8XY_.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{h as W,H as _,G as $,j as G,o as H,J as h,a as c,k as f,b as t,d as o,e as l,t as k,w as i,F as D,A as J,f as b,c as M,x as Q,g as w,_ as P,K as q,Q as X,S as Y,V as Z}from"./index-zLBKAhNj.js";import ee from"./index-fuTe51Z2.js";import{m as E}from"./md5-B0f4dnXe.js";import{u as se}from"./auth-VwksntSK.js";const u=p=>(Y("data-v-bc2b029b"),p=p(),Z(),p),te=u(()=>t("div",null,[t("h2",null,"认证界面")],-1)),ae={key:0,AuthCardDialogAuthed:""},oe={style:{width:"100%"}},re=u(()=>t("td",null,"用户名",-1)),le=u(()=>t("td",null,"权限级别",-1)),ne={colspan:"2"},ie=u(()=>t("br",null,null,-1)),ue=u(()=>t("br",null,null,-1)),de={key:1,AuthCardDialogUnauthed:""},ce=u(()=>t("label",null,"账户名",-1)),me=u(()=>t("label",null,"密码",-1)),ve=u(()=>t("label",null,"管理员秘钥",-1)),_e=u(()=>t("br",null,null,-1)),he={__name:"AuthShow",setup(p){const x=w(()=>P(()=>import("./IconUser-BBjiCtaS.js"),__vite__mapDeps([0,1,2]))),L=w(()=>P(()=>import("./index-CtRsV90Y.js"),__vite__mapDeps([3,1,2]))),T=w(()=>P(()=>import("./index-CgkV2Wch.js"),__vite__mapDeps([4,1,2,5,6,7]))),K=w(()=>P(()=>import("./index-DxQT8XY_.js"),__vite__mapDeps([8,1,2]))),e=se(),y=_(!1),d=_(""),g=_(!1),I=_(""),m=_(""),r=$(),V=()=>d.value.length==0||m.value.length==0,C=()=>E(E(m.value+"DAOLUOLTS").toString()),z=()=>{y.value=!0,g.value=!1,d.value="",m.value="",I.value=""},O=G(()=>Object.keys(e.getUserInfo()));H(()=>{h("/auth/checkLogin",{method:"post"}).then(a=>{const s=a.data;e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0),r.add({severity:"success",summary:"身份验证",detail:"已通过身份验证，欢迎回来："+s.userName,life:3e3})}).catch(()=>{r.add({severity:"error",summary:"当前未登录",detail:"请先登录",life:3e3})})});const B=()=>{if(V())return r.add({severity:"error",summary:"错误",detail:"账号或密码不能为空",life:3e3});if(!g.value)return g.value=!0;h("/auth/register",{method:"post",data:{userName:d.value,userPassword:C(),adminKey:I.value}}).then(a=>{const s=a.data;try{e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0)}catch(v){console.error(v)}finally{r.add({severity:"success",summary:"成功",detail:s.msg,life:3e3})}}).catch(a=>{r.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},S=()=>{if(V())return r.add({severity:"error",summary:"错误",detail:"账号或密码不能为空",life:3e3});h("/auth/login",{method:"post",data:{userName:d.value,userPassword:C()}}).then(a=>{const s=a.data;e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0),r.add({severity:"success",summary:"成功",detail:s.msg,life:3e3}),y.value=!1}).catch(a=>{r.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},F=()=>{if(!e.getIsLogin())return r.add({severity:"error",summary:"错误",detail:"当前已经是未登录状态，请刷新页面尝试修正显示。",life:3e3});h("/auth/logout",{method:"post"}).then(a=>{a.data,e.setIsLogin(!1),e.setUserName(""),e.setUserPermission("none"),e.coverUserInfo({}),r.add({severity:"success",summary:"成功",detail:"完成登出，现在是未登录状态。",life:3e3}),location.reload()}).catch(a=>{r.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},R=()=>{if(!e.getIsLogin())return r.add({severity:"error",summary:"错误",detail:"当前已经是未登录状态，请刷新页面尝试修正显示。",life:3e3});h("/auth/checkLogin",{method:"post"}).then(a=>{const s=a.data;e.setUserName(s.userName),e.setUserPermission(s.userPermission),e.coverUserInfo(s.userInfo),e.setIsLogin(!0),r.add({severity:"success",summary:"成功",detail:"已收到服务器下发的新Session",life:3e3})}).catch(a=>{r.add({severity:"error",summary:"错误",detail:a.response.data.msg,life:3e3})})},A=a=>{if(a.key=="Enter")return S()},j=()=>{switch(e.getUserPermission()){case"none":return"";case"user":return"success";case"admin":return"danger"}};return(a,s)=>{const v=ee,U=q,N=X;return c(),f(D,null,[t("div",{AuthCardContainer:"",onClick:z},[o(l(x)),t("span",null,k(l(e).getIsLogin()?l(e).getUserName():"未登录"),1)]),o(l(T),{visible:y.value,"onUpdate:visible":s[3]||(s[3]=n=>y.value=n),modal:"",header:"认证界面",style:{maxWidth:"50vw",minWidth:"350px"}},{header:i(()=>[te]),default:i(()=>[l(e).isLogin?(c(),f("div",ae,[t("div",null,[t("table",oe,[t("tbody",null,[t("tr",null,[re,t("td",null,k(l(e).getUserName()),1)]),t("tr",null,[le,t("td",null,[o(l(K),{value:l(e).getUserPermission(),severity:j(),rounded:""},null,8,["value","severity"])])]),t("tr",null,[t("td",ne,[o(v,{style:{width:"100%"}})])]),(c(!0),f(D,null,J(O.value,n=>(c(),f("tr",null,[t("td",null,k(n),1),t("td",null,k(l(e).getUserInfo()[n]),1)]))),256))])]),ie,ue]),t("div",null,[o(U,{size:"small",onClick:R},{default:i(()=>[b("刷新")]),_:1}),o(v,{layout:"vertical"}),o(U,{size:"small",onClick:F},{default:i(()=>[b("登出")]),_:1})])])):(c(),f("div",de,[t("div",null,[o(l(L),null,{default:i(()=>[o(N,{size:"small",onKeydown:A,modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=n=>d.value=n),placeholder:"必填"},null,8,["modelValue"]),ce]),_:1}),o(l(L),null,{default:i(()=>[o(N,{size:"small",type:"password",onKeydown:A,modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=n=>m.value=n),placeholder:"必填"},null,8,["modelValue"]),me]),_:1}),g.value?(c(),M(l(L),{key:0},{default:i(()=>[o(N,{size:"small",modelValue:I.value,"onUpdate:modelValue":s[2]||(s[2]=n=>I.value=n),placeholder:"选填"},null,8,["modelValue"]),ve]),_:1})):Q("",!0)]),_e,t("div",null,[o(U,{size:"small",onClick:B,severity:"secondary"},{default:i(()=>[b("注册")]),_:1}),o(v,{layout:"vertical"}),o(U,{size:"small",onClick:S},{default:i(()=>[b("登录")]),_:1})])]))]),_:1},8,["visible"])],64)}}},Ie=W(he,[["__scopeId","data-v-bc2b029b"]]);export{Ie as default};
